function reciposszeg(A,B)
    return 1/(1/A+1/B)
end
R={} U={} I={}

-- A -> mindenhol az áram iránya
--[[
    
    +-----(R1=8.2)----+----(R7=3,31)---+
    |                 |                |
    +(<-Ug=12)+       +-(R3=18)-+      +-(<-If=1)-+
              |                 |                 |
              +------(R5=15)----+-----(R4=7,5)----+

--]]

R[1]=8.2
R[2]=3.9
R[3]=18
R[4]=7.5
R[5]=15
R[6]=22
R[7]=reciposszeg(R[2],R[6])
If=1
Ug=12

--Szuperpozíció

function szakadas()
    local U, I = {},{}

    --[[
    
    +-----(R1=8.2)----+
    |                 |          
    +(<-Ug=12)+       +-(R3=18)-+
              |                 |
              +------(R5=15)----+

    --]]

    R["531"]=R[1]+R[3]+R[5]

    U["531"]=Ug
    I["531"]=U["531"]/R["531"]

        I[5]=I["531"]
        U[5]=I[5]*R[5]

        I[3]=I["531"]
        U[3]=I[3]*R[3]

        I[1]=I["531"]
        U[1]=I[1]*R[1]

    for i=1,7 do
        print("R["..i.."]="..tostring(R[i]),"I["..i.."]="..tostring(I[i]),"U["..i.."]="..tostring(U[i]))
    end
    print("")

    --[[
        R[1]=8.2                I[1]=0.29126213592233   U[1]=2.3883495145631
        R[2]=3.9                I[2]=nil                U[2]=nil
        R[3]=18                 I[3]=0.29126213592233   U[3]=5.2427184466019
        R[4]=7.5                I[4]=nil                U[4]=nil
        R[5]=15                 I[5]=0.29126213592233   U[5]=4.368932038835
        R[6]=22                 I[6]=nil                U[6]=nil
        R[7]=3.3127413127413    I[7]=nil                U[7]=nil
    --]]

    return U,I
end

function rovidzar()
    local U, I = {},{}

    --[[
    
    +-----(R1=8.2)----+----(R7=3,31)---+
    |                 |                |
    +---------+       +-(R3=18)-+      +-(<-If=1)-+
              |                 |                 |
              +------(R5=15)----+-----(R4=7,5)----+

    --]]
    
    R["51"]=R[5]+R[1]
    R["513"]=reciposszeg(R["51"],R[3])
    R["51374"]=R["513"]+R[7]+R[4]

    I["51374"]=If
    U["51374"]=I["51374"]*R["51374"]

        I["513"]=I["51374"]
        U["513"]=I["513"]*R["513"]

            U["51"]=U["513"]
            I["51"]=U["51"]/R["51"]

                I[5]=I["51"]
                U[5]=I[5]*R[5]

                I[1]=I["51"]
                U[1]=I[1]*R[1]

            U[3]=U["513"]
            I[3]=U[3]/R[3]

        I[7]=I["51374"]
        U[7]=I[7]*R[7]

        I[4]=I["51374"]
        U[4]=I[4]*R[4]

    for i=1,7 do
        print("R["..i.."]="..tostring(R[i]),"I["..i.."]="..tostring(I[i]),"U["..i.."]="..tostring(U[i]))
    end
    print("")

    --[[
        R[1]=8.2                I[1]=0.4368932038835    U[1]=3.5825242718447
        R[2]=3.9                I[2]=nil                U[2]=nil
        R[3]=18                 I[3]=0.5631067961165    U[3]=10.135922330097
        R[4]=7.5                I[4]=1                  U[4]=7.5
        R[5]=15                 I[5]=0.4368932038835    U[5]=6.5533980582524
        R[6]=22                 I[6]=nil                U[6]=nil
        R[7]=3.3127413127413    I[7]=1                  U[7]=3.3127413127413
    --]]

    return U,I
end

sU,sI = szakadas()
rU,rI  = rovidzar()


U[1], I[1] = (rU[1] or 0)-(sU[1] or 0),  (rI[1] or 0)-(sI[1] or 0)
U[2], I[2] = (rU[2] or 0)-(sU[2] or 0),  (rI[2] or 0)-(sI[2] or 0)
U[3], I[3] = (rU[3] or 0)+(sU[3] or 0),  (rI[3] or 0)+(sI[3] or 0) --Egy irányba megy át rajta a 2 gen.
U[4], I[4] = (rU[4] or 0)-(sU[4] or 0),  (rI[4] or 0)-(sI[4] or 0)
U[5], I[5] = (rU[5] or 0)-(sU[5] or 0),  (rI[5] or 0)-(sI[5] or 0)
U[6], I[6] = (rU[6] or 0)-(sU[6] or 0),  (rI[6] or 0)-(sI[6] or 0)
U[7], I[7] = (rU[7] or 0)-(sU[7] or 0),  (rI[7] or 0)-(sI[7] or 0)



--R[7] szétbontása
U[2]=U[7]
I[2]=U[2]/R[2]

U[6]=U[7]
I[6]=U[6]/R[6]


for i=1,7 do
    print("R["..i.."]="..R[i],"I["..i.."]="..I[i],"U["..i.."]="..U[i])
end
print("")

--[[
    R[1]=8.2                I[1]=0.14563106796117   U[1]=1.1941747572816
    R[2]=3.9                I[2]=0.84942084942085   U[2]=3.3127413127413
    R[3]=18                 I[3]=0.85436893203884   U[3]=15.378640776699
    R[4]=7.5                I[4]=1                  U[4]=7.5
    R[5]=15                 I[5]=0.14563106796117   U[5]=2.1844660194175
    R[6]=22                 I[6]=0.15057915057915   U[6]=3.3127413127413
    R[7]=3.3127413127413    I[7]=1                  U[7]=3.3127413127413
--]]

--Teljesítmények:
local o = 0
for i=1,7 do
    print("P["..i.."]="..U[i]*I[i])
    o = o + U[i]*I[i]
end
print("P['654321']="..o-U[7]*I[7])

--[[
    P[1]=0.17390894523518
    P[2]=2.8139115397803
    P[3]=13.139032896597
    P[4]=7.5
    P[5]=0.31812611933264
    P[6]=0.49882977296105
    P[7]=3.3127413127413
--]]